<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telecimento - Painel Administrativo</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            overflow-x: hidden;
            width: 100%;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 50%, #2d2d2d 100%);
            color: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
            width: 100%;
            max-width: 100vw;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            width: 100%;
            box-sizing: border-box;
        }

        /* Header */
        .header {
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 2px solid #FFD700;
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            width: 100%;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .logo-text {
            font-size: 2.5rem;
            font-weight: 800;
            margin: 0;
            letter-spacing: 1px;
            flex-shrink: 0;
        }

        .tele {
            color: #ffffff;
        }

        .cimento {
            color: #cccccc;
        }

        .back-btn {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: #000;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(255, 215, 0, 0.3);
        }

        /* Admin Panel */
        .admin-panel {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 20px;
            padding: 3rem;
            margin-top: 2rem;
            backdrop-filter: blur(10px);
            width: 100%;
            max-width: 100%;
            box-sizing: border-box;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 3rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #FFD700;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .admin-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: #FFD700;
            word-wrap: break-word;
        }

        .admin-actions {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .clear-data-btn {
            background: #ff6b6b;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            white-space: nowrap;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .stat-card {
            background: rgba(255, 215, 0, 0.1);
            border: 2px solid #FFD700;
            border-radius: 15px;
            padding: 2rem;
            text-align: center;
            min-width: 0;
        }

        .stat-number {
            font-size: 3rem;
            font-weight: 800;
            color: #FFD700;
            margin-bottom: 0.5rem;
            word-wrap: break-word;
        }

        .stat-label {
            color: #e0e0e0;
            font-weight: 500;
            word-wrap: break-word;
        }

        .report-blocks {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .report-block {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 15px;
            padding: 2rem;
            min-width: 0;
        }

        .block-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #FFD700;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 10px;
            word-wrap: break-word;
        }

        .block-content {
            color: #e0e0e0;
            line-height: 1.6;
        }

        .metric-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(255, 215, 0, 0.2);
            word-wrap: break-word;
        }

        .metric-item:last-child {
            border-bottom: none;
        }

        .metric-label {
            color: #e0e0e0;
            flex: 1;
            min-width: 0;
        }

        .metric-value {
            color: #FFD700;
            font-weight: 600;
            flex-shrink: 0;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            width: 100%;
            overflow-x: auto;
        }

        .chart-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #FFD700;
            margin-bottom: 1rem;
            text-align: center;
            word-wrap: break-word;
        }

        .chart {
            width: 100%;
            height: 300px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #e0e0e0;
            min-width: 600px;
        }

        .chart-legend {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            white-space: nowrap;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 3px;
            flex-shrink: 0;
        }

        .filters {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .download-options {
            display: flex;
            gap: 0.5rem;
            margin-left: auto;
            flex-wrap: wrap;
        }

        .opinions-container {
            width: 100%;
            overflow-x: hidden;
        }

        .opinion-filters {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .opinion-filter-btn {
            background: rgba(255, 215, 0, 0.2);
            color: #FFD700;
            border: 1px solid #FFD700;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .opinion-filter-btn:hover {
            background: rgba(255, 215, 0, 0.3);
            transform: translateY(-2px);
        }

        .opinion-filter-btn.active {
            background: #FFD700;
            color: #1a1a1a;
        }

        .opinions-list {
            max-height: 400px;
            overflow-y: auto;
            overflow-x: hidden;
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 8px;
            padding: 1rem;
        }

        .opinion-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
            word-wrap: break-word;
        }

        .opinion-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 215, 0, 0.4);
        }

        .opinion-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            color: #FFD700;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .opinion-rating {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .opinion-text {
            color: #ffffff;
            line-height: 1.5;
            font-style: italic;
            margin-bottom: 0.5rem;
            word-wrap: break-word;
        }

        .opinion-sectors {
            display: flex;
            gap: 1rem;
            font-size: 0.8rem;
            color: #cccccc;
            flex-wrap: wrap;
        }

        .opinion-sector {
            display: flex;
            align-items: center;
            gap: 0.3rem;
            white-space: nowrap;
        }

        .no-opinions {
            text-align: center;
            color: #cccccc;
            font-style: italic;
            padding: 2rem;
        }

        .filter-btn {
            background: rgba(255, 215, 0, 0.2);
            border: 2px solid #FFD700;
            color: #FFD700;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .filter-btn:hover,
        .filter-btn.active {
            background: #FFD700;
            color: #000;
        }

        .download-btn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: #fff;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            margin-left: auto;
            white-space: nowrap;
        }

        .message {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 2rem;
            border-radius: 10px;
            font-weight: 600;
            z-index: 3000;
            transform: translateX(400px);
            transition: all 0.3s ease;
            max-width: 300px;
            word-wrap: break-word;
        }

        .message.show {
            transform: translateX(0);
        }

        .message.success {
            background: #4CAF50;
            color: #fff;
        }

        .message.error {
            background: #f44336;
            color: #fff;
        }

        .message.warning {
            background: #ff9800;
            color: #fff;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .container {
                padding: 1rem;
            }
            
            .admin-panel {
                padding: 2rem;
            }
            
            .report-blocks {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
                padding: 0 1rem;
            }
            
            .logo-text {
                font-size: 2rem;
            }
            
            .back-btn {
                padding: 10px 20px;
                font-size: 0.9rem;
            }
            
            .container {
                padding: 0.5rem;
            }
            
            .admin-panel {
                margin: 0.5rem 0;
                padding: 1.5rem;
                border-radius: 15px;
            }
            
            .admin-header {
                flex-direction: column;
                text-align: center;
            }

            .admin-title {
                font-size: 2rem;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }
            
            .report-blocks {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .filters {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }
            
            .download-options {
                margin-left: 0;
                margin-top: 1rem;
                justify-content: center;
            }
            
            .filter-btn {
                width: 100%;
                text-align: center;
            }

            .chart {
                min-width: 300px;
            }
        }

        @media (max-width: 480px) {
            .header-content {
                padding: 0 0.5rem;
            }
            
            .logo-text {
                font-size: 1.8rem;
                letter-spacing: 0.5px;
            }
            
            .back-btn {
                padding: 8px 16px;
                font-size: 0.8rem;
                border-radius: 20px;
            }
            
            .back-btn i {
                font-size: 0.8rem;
            }
            
            .container {
                padding: 0.25rem;
            }
            
            .admin-panel {
                margin: 0.25rem 0;
                padding: 1rem;
                border-radius: 12px;
            }

            .admin-title {
                font-size: 1.5rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 0.8rem;
            }
            
            .stat-card {
                padding: 1rem;
            }
            
            .stat-number {
                font-size: 2rem;
            }
            
            .stat-label {
                font-size: 0.8rem;
            }
            
            .report-blocks {
                gap: 0.8rem;
            }
            
            .report-block {
                padding: 1rem;
            }
            
            .block-title {
                font-size: 1rem;
                margin-bottom: 0.8rem;
            }
            
            .metric-item {
                font-size: 0.8rem;
                margin-bottom: 0.3rem;
            }
            
            .filters {
                gap: 0.8rem;
            }
            
            .filter-btn {
                padding: 0.6rem 1rem;
                font-size: 0.8rem;
            }

            .chart {
                min-width: 250px;
                height: 200px;
            }

            .chart-legend {
                gap: 0.5rem;
                font-size: 0.8rem;
            }

            .legend-color {
                width: 15px;
                height: 15px;
            }
        }

        /* Touch-friendly improvements */
        @media (hover: none) and (pointer: coarse) {
            .filter-btn {
                min-height: 44px;
                touch-action: manipulation;
            }
            
            .opinion-filter-btn {
                min-height: 44px;
                touch-action: manipulation;
            }
            
            .back-btn {
                min-height: 44px;
                touch-action: manipulation;
            }
            
            .clear-data-btn {
                min-height: 44px;
                touch-action: manipulation;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <h1 class="logo-text">
                <span class="tele">Tele</span><span class="cimento">CIMENTO</span>
            </h1>
            <a href="index.html" class="back-btn">
                <i class="fas fa-arrow-left"></i>
                Voltar ao Opini√¥metro
            </a>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container">
        <!-- Admin Panel -->
        <div class="admin-panel">
            <div class="admin-header">
                <h2 class="admin-title">Painel Administrativo</h2>
                <div class="admin-actions">
                    <button class="clear-data-btn" onclick="clearAllData()">
                        <i class="fas fa-trash"></i>
                        Apagar Dados
                    </button>
                    <button class="clear-data-btn" onclick="resetVotingTime()" style="background: #4CAF50;">
                        <i class="fas fa-redo"></i>
                        Resetar Vota√ß√£o
                    </button>
                </div>
            </div>

            <!-- Statistics -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalVotes">0</div>
                    <div class="stat-label">Total de Votos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="todayVotes">0</div>
                    <div class="stat-label">Votos Hoje</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="avgRating">0.0</div>
                    <div class="stat-label">M√©dia Geral</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="satisfactionRate">0%</div>
                    <div class="stat-label">Taxa de Satisfa√ß√£o</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="feedbackCount">0</div>
                    <div class="stat-label">Feedbacks Recebidos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="avgResponseTime">0</div>
                    <div class="stat-label">Tempo M√©dio (min)</div>
                </div>
            </div>

            <!-- Report Blocks -->
            <div class="report-blocks">
                <div class="report-block">
                    <div class="block-title">
                        <i class="fas fa-chart-pie"></i>
                        Resumo Geral
                    </div>
                    <div class="block-content" id="generalSummary">
                        <div class="metric-item">
                            <span class="metric-label">Avalia√ß√µes Positivas:</span>
                            <span class="metric-value" id="positiveRatings">0%</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Avalia√ß√µes Negativas:</span>
                            <span class="metric-value" id="negativeRatings">0%</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Melhor Setor:</span>
                            <span class="metric-value" id="bestSector">-</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Setor a Melhorar:</span>
                            <span class="metric-value" id="worstSector">-</span>
                        </div>
                    </div>
                </div>

                <div class="report-block">
                    <div class="block-title">
                        <i class="fas fa-shopping-cart"></i>
                        Setor de Vendas
                    </div>
                    <div class="block-content" id="salesReport">
                        <div class="metric-item">
                            <span class="metric-label">M√©dia de Avalia√ß√£o:</span>
                            <span class="metric-value" id="salesAvg">0.0</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Total de Avalia√ß√µes:</span>
                            <span class="metric-value" id="salesTotal">0</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Satisfa√ß√£o:</span>
                            <span class="metric-value" id="salesSatisfaction">0%</span>
                        </div>
                    </div>
                </div>

                <div class="report-block">
                    <div class="block-title">
                        <i class="fas fa-cash-register"></i>
                        Caixa
                    </div>
                    <div class="block-content" id="cashReport">
                        <div class="metric-item">
                            <span class="metric-label">M√©dia de Avalia√ß√£o:</span>
                            <span class="metric-value" id="cashAvg">0.0</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Total de Avalia√ß√µes:</span>
                            <span class="metric-value" id="cashTotal">0</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Satisfa√ß√£o:</span>
                            <span class="metric-value" id="cashSatisfaction">0%</span>
                        </div>
                    </div>
                </div>

                <div class="report-block">
                    <div class="block-title">
                        <i class="fas fa-shipping-fast"></i>
                        Setor de Expedi√ß√£o
                    </div>
                    <div class="block-content" id="shippingReport">
                        <div class="metric-item">
                            <span class="metric-label">M√©dia de Avalia√ß√£o:</span>
                            <span class="metric-value" id="shippingAvg">0.0</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Total de Avalia√ß√µes:</span>
                            <span class="metric-value" id="shippingTotal">0</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Satisfa√ß√£o:</span>
                            <span class="metric-value" id="shippingSatisfaction">0%</span>
                        </div>
                    </div>
                </div>

                <div class="report-block">
                    <div class="block-title">
                        <i class="fas fa-comments"></i>
                        An√°lise de Feedbacks
                    </div>
                    <div class="block-content" id="feedbackAnalysis">
                        <div class="metric-item">
                            <span class="metric-label">Feedbacks Positivos:</span>
                            <span class="metric-value" id="positiveFeedbacks">0</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Feedbacks Negativos:</span>
                            <span class="metric-value" id="negativeFeedbacks">0</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Sugest√µes de Melhoria:</span>
                            <span class="metric-value" id="suggestions">0</span>
                        </div>
                    </div>
                </div>

                <div class="report-block">
                    <div class="block-title">
                        <i class="fas fa-clock"></i>
                        An√°lise Temporal
                    </div>
                    <div class="block-content" id="timeReport">
                        <div class="metric-item">
                            <span class="metric-label">Pico de Avalia√ß√µes:</span>
                            <span class="metric-value" id="peakTime">14:00h</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Tend√™ncia Semanal:</span>
                            <span class="metric-value" id="weeklyTrend">Crescente</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Crescimento Mensal:</span>
                            <span class="metric-value" id="monthlyGrowth">+15%</span>
                        </div>
                    </div>
                </div>

                <div class="report-block">
                    <div class="block-title">
                        <i class="fas fa-quote-left"></i>
                        Opini√µes dos Clientes
                    </div>
                    <div class="block-content" id="customerOpinions">
                        <div class="opinions-container">
                            <div class="opinion-filters">
                                <button class="opinion-filter-btn active" onclick="filterOpinions('all')">Todas</button>
                                <button class="opinion-filter-btn" onclick="filterOpinions('positive')">Positivas</button>
                                <button class="opinion-filter-btn" onclick="filterOpinions('negative')">Negativas</button>
                                <button class="opinion-filter-btn" onclick="filterOpinions('suggestions')">Sugest√µes</button>
                            </div>
                            <div class="opinions-list" id="opinionsList">
                                <!-- Opini√µes ser√£o carregadas aqui via JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Filters -->
            <div class="filters">
                <button class="filter-btn active" onclick="filterData('all')">Todos</button>
                <button class="filter-btn" onclick="filterData('today')">Hoje</button>
                <button class="filter-btn" onclick="filterData('week')">Esta Semana</button>
                <button class="filter-btn" onclick="filterData('month')">Este M√™s</button>
                <div class="download-options">
                    <button class="download-btn" onclick="downloadReport('csv')">
                        <i class="fas fa-file-csv"></i>
                        CSV
                    </button>
                    <button class="download-btn" onclick="downloadReport('txt')">
                        <i class="fas fa-file-alt"></i>
                        Bloco de Notas
                    </button>
                    <button class="download-btn" onclick="downloadReport('json')">
                        <i class="fas fa-file-code"></i>
                        JSON
                    </button>
                    <button class="download-btn" onclick="downloadCompleteReport()">
                        <i class="fas fa-file-download"></i>
                        Relat√≥rio Completo
                    </button>
                </div>
            </div>

            <!-- Charts -->
            <div class="chart-container">
                <h3 class="chart-title">Distribui√ß√£o de Avalia√ß√µes Gerais</h3>
                <div class="chart" id="generalChart">
                    <canvas id="generalChartCanvas" width="800" height="300"></canvas>
                </div>
                <div class="chart-legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #ff4444;"></div>
                        <span>Ruim</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #ff9800;"></div>
                        <span>Regular</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #4CAF50;"></div>
                        <span>Bom</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #FFD700;"></div>
                        <span>Excelente</span>
                    </div>
                </div>
            </div>

            <div class="chart-container">
                <h3 class="chart-title">Desempenho por Setor</h3>
                <div class="chart" id="sectorChart">
                    <canvas id="sectorChartCanvas" width="800" height="300"></canvas>
                </div>
                <div class="chart-legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #FFD700;"></div>
                        <span>Vendas</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #FFA500;"></div>
                        <span>Caixa</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #FF8C00;"></div>
                        <span>Expedi√ß√£o</span>
                    </div>
                </div>
            </div>

            <div class="chart-container">
                <h3 class="chart-title">Evolu√ß√£o Temporal das Avalia√ß√µes</h3>
                <div class="chart" id="timeChart">
                    <canvas id="timeChartCanvas" width="800" height="300"></canvas>
                </div>
                <div class="chart-legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #FFD700;"></div>
                        <span>Votos por Dia</span>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Message Container -->
    <div id="messageContainer"></div>

    <script>
// Sistema de Opini√¥metro Telecimento - Admin JavaScript
class OpiniometroAdmin {
    constructor() {
        this.votes = [];
        this.currentFilter = 'all';
        this.currentOpinionFilter = 'all';
        
        // Dados da empresa
        this.companyData = {
            name: 'TELECIMENTO',
            fullName: 'Grupo Telecimento',
            address: 'Av. Manoel Caribe Filho, 3325 - Canelas, Montes Claros',
            phone: '(38) 9 3212-1823',
            instagram: '@grupotelecimento',
            instagramUrl: 'https://www.instagram.com/grupotelecimento?igsh=MW93bzNrOHExcmIwMg==',
            whatsappUrl: 'https://wa.me/5538932121823',
            sectors: ['Vendas', 'Caixa', 'Expedi√ß√£o']
        };
        
        this.init();
    }

    init() {
        this.loadVotesFromLocalStorage();
        this.updateAdminStats();
        this.updateReportBlocks();
        this.updateCustomerOpinions();
        this.renderCharts();
    }

    loadVotesFromLocalStorage() {
        try {
            const storedVotes = localStorage.getItem('telecimento_votes');
            this.votes = storedVotes ? JSON.parse(storedVotes) : [];
        } catch (error) {
            console.error('Erro ao carregar avalia√ß√µes do localStorage:', error);
            this.votes = [];
        }
    }

    saveVotesToLocalStorage() {
        localStorage.setItem('telecimento_votes', JSON.stringify(this.votes));
    }

    clearAllData() {
        if (confirm('ATEN√á√ÉO: Esta a√ß√£o ir√° apagar TODOS os dados de avalia√ß√µes permanentemente. Deseja continuar?')) {
            if (confirm('Tem certeza absoluta? Esta a√ß√£o n√£o pode ser desfeita!')) {
                try {
                    localStorage.removeItem('telecimento_votes');
                    localStorage.removeItem('telecimento_lastVoteTime');
                    localStorage.removeItem('telecimento_voting_reset');
                    this.votes = [];

                    this.updateAdminStats();
                    this.updateReportBlocks();
                    this.updateCustomerOpinions();
                    this.renderCharts();

                    this.showMessage('Todos os dados de avalia√ß√£o foram apagados com sucesso!', 'success');
                } catch (error) {
                    console.error('Erro ao limpar dados:', error);
                    this.showMessage('Erro ao limpar dados. Tente novamente.', 'error');
                }
            }
        }
    }

    resetVotingTime() {
        if (confirm('ATEN√á√ÉO: Esta a√ß√£o ir√° permitir que TODOS os dispositivos votem novamente, independente do tempo de espera. Deseja continuar?')) {
            try {
                const resetTimestamp = new Date().getTime().toString();
                localStorage.setItem('telecimento_voting_reset', resetTimestamp);
                this.showMessage('Tempo de vota√ß√£o resetado para todos os dispositivos!', 'success');
            } catch (error) {
                console.error('Erro ao resetar tempo de vota√ß√£o:', error);
                this.showMessage('Erro ao resetar tempo de vota√ß√£o. Tente novamente.', 'error');
            }
        }
    }

    updateAdminStats() {
        const filteredVotes = this.getFilteredVotes();
        const today = new Date().toISOString().split('T')[0];
        const todayVotes = this.votes.filter(vote => vote.date === today);

        // Basic stats
        document.getElementById('totalVotes').textContent = this.votes.length;
        document.getElementById('todayVotes').textContent = todayVotes.length;

        // Average rating
        const avgRating = this.calculateAverageRating(filteredVotes);
        document.getElementById('avgRating').textContent = avgRating.toFixed(1);

        // Satisfaction rate (bom + excelente)
        const satisfactionRate = this.calculateSatisfactionRate(filteredVotes);
        document.getElementById('satisfactionRate').textContent = satisfactionRate + '%';

        // Feedback count
        const feedbackCount = filteredVotes.filter(vote => vote.feedback && vote.feedback.trim().length > 0).length;
        document.getElementById('feedbackCount').textContent = feedbackCount;

        // Average response time (simulated)
        const avgResponseTime = Math.floor(Math.random() * 5) + 2;
        document.getElementById('avgResponseTime').textContent = avgResponseTime;
    }

    getFilteredVotes() {
        const now = new Date();
        const today = new Date().toISOString().split('T')[0];

        switch (this.currentFilter) {
            case 'today':
                return this.votes.filter(vote => vote.date === today);
            case 'week':
                const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                return this.votes.filter(vote => new Date(vote.timestamp) >= weekAgo);
            case 'month':
                const monthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
                return this.votes.filter(vote => new Date(vote.timestamp) >= monthAgo);
            default:
                return this.votes;
        }
    }

    calculateAverageRating(votes) {
        if (votes.length === 0) return 0;

        const ratingValues = {
            'ruim': 1,
            'regular': 2,
            'bom': 3,
            'excelente': 4
        };

        const sum = votes.reduce((acc, vote) => {
            return acc + (ratingValues[vote.generalRating] || 0);
        }, 0);

        return sum / votes.length;
    }

    calculateSatisfactionRate(votes) {
        if (votes.length === 0) return 0;

        const satisfiedVotes = votes.filter(vote => 
            vote.generalRating === 'bom' || vote.generalRating === 'excelente'
        );

        return Math.round((satisfiedVotes.length / votes.length) * 100);
    }

    filterData(filter) {
        this.currentFilter = filter;

        // Update filter buttons
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        // Find the clicked button using event.target and add 'active' class
        const clickedButton = event.target;
        if (clickedButton && clickedButton.classList.contains('filter-btn')) {
            clickedButton.classList.add('active');
        }

        // Update stats and charts
        this.updateAdminStats();
        this.updateReportBlocks();
        this.updateCustomerOpinions();
        this.renderCharts();
    }

    updateReportBlocks() {
        const filteredVotes = this.getFilteredVotes();
        
        // General Summary
        this.updateGeneralSummary(filteredVotes);
        
        // Sector Reports
        this.updateSectorReports(filteredVotes);
        
        // Feedback Analysis
        this.updateFeedbackAnalysis(filteredVotes);
        
        // Time Analysis
        this.updateTimeAnalysis(filteredVotes);
    }

    updateGeneralSummary(votes) {
        const positiveVotes = votes.filter(vote => 
            vote.generalRating === 'bom' || vote.generalRating === 'excelente'
        );
        const negativeVotes = votes.filter(vote => 
            vote.generalRating === 'ruim' || vote.generalRating === 'regular'
        );

        const positiveRate = votes.length > 0 ? Math.round((positiveVotes.length / votes.length) * 100) : 0;
        const negativeRate = votes.length > 0 ? Math.round((negativeVotes.length / votes.length) * 100) : 0;

        document.getElementById('positiveRatings').textContent = positiveRate + '%';
        document.getElementById('negativeRatings').textContent = negativeRate + '%';

        // Best and worst sectors
        const sectorAverages = this.calculateSectorAverages(votes);
        const sectors = Object.keys(sectorAverages);
        
        if (sectors.length > 0) {
            const bestSector = sectors.reduce((a, b) => sectorAverages[a] > sectorAverages[b] ? a : b);
            const worstSector = sectors.reduce((a, b) => sectorAverages[a] < sectorAverages[b] ? a : b);
            
            document.getElementById('bestSector').textContent = this.getSectorName(bestSector);
            document.getElementById('worstSector').textContent = this.getSectorName(worstSector);
        }
    }

    calculateSectorAverages(votes) {
        const sectors = ['vendas', 'caixa', 'expedicao'];
        const ratingValues = {
            'ruim': 1,
            'regular': 2,
            'bom': 3,
            'excelente': 4
        };

        const averages = {};
        sectors.forEach(sector => {
            const sectorVotes = votes.filter(vote => vote.sectorRatings && vote.sectorRatings[sector]);
            if (sectorVotes.length > 0) {
                const sum = sectorVotes.reduce((acc, vote) => {
                    return acc + (ratingValues[vote.sectorRatings[sector]] || 0);
                }, 0);
                averages[sector] = sum / sectorVotes.length;
            } else {
                averages[sector] = 0;
            }
        });

        return averages;
    }

    getSectorName(sector) {
        const names = {
            'vendas': 'Vendas',
            'caixa': 'Setor de Caixa',
            'expedicao': 'Expedi√ß√£o'
        };
        return names[sector] || sector;
    }

    updateSectorReports(votes) {
        const sectors = ['vendas', 'caixa', 'expedicao'];
        const sectorNames = {
            'vendas': 'sales',
            'caixa': 'cash',
            'expedicao': 'shipping'
        };

        sectors.forEach(sector => {
            const sectorVotes = votes.filter(vote => vote.sectorRatings && vote.sectorRatings[sector]);
            const avg = this.calculateSectorAverage(votes, sector);
            const satisfaction = this.calculateSectorSatisfaction(votes, sector);
            
            const prefix = sectorNames[sector];
            document.getElementById(`${prefix}Avg`).textContent = avg.toFixed(1);
            document.getElementById(`${prefix}Total`).textContent = sectorVotes.length;
            document.getElementById(`${prefix}Satisfaction`).textContent = satisfaction + '%';
        });
    }

    calculateSectorAverage(votes, sector) {
        const ratingValues = {
            'ruim': 1,
            'regular': 2,
            'bom': 3,
            'excelente': 4
        };

        const sectorVotes = votes.filter(vote => vote.sectorRatings && vote.sectorRatings[sector]);
        if (sectorVotes.length === 0) return 0;

        const sum = sectorVotes.reduce((acc, vote) => {
            return acc + (ratingValues[vote.sectorRatings[sector]] || 0);
        }, 0);

        return sum / sectorVotes.length;
    }

    calculateSectorSatisfaction(votes, sector) {
        const sectorVotes = votes.filter(vote => vote.sectorRatings && vote.sectorRatings[sector]);
        if (sectorVotes.length === 0) return 0;

        const satisfiedVotes = sectorVotes.filter(vote => 
            vote.sectorRatings[sector] === 'bom' || vote.sectorRatings[sector] === 'excelente'
        );

        return Math.round((satisfiedVotes.length / sectorVotes.length) * 100);
    }

    updateFeedbackAnalysis(votes) {
        const feedbacks = votes.filter(vote => vote.feedback && vote.feedback.trim().length > 0);
        
        // Simple sentiment analysis based on keywords
        const positiveKeywords = ['bom', '√≥timo', 'excelente', 'parab√©ns', 'satisfeito', 'recomendo'];
        const negativeKeywords = ['ruim', 'p√©ssimo', 'demora', 'problema', 'insatisfeito', 'reclama√ß√£o'];
        
        let positiveFeedbacks = 0;
        let negativeFeedbacks = 0;
        let suggestions = 0;

        feedbacks.forEach(vote => {
            const text = vote.feedback.toLowerCase();
            const hasPositive = positiveKeywords.some(keyword => text.includes(keyword));
            const hasNegative = negativeKeywords.some(keyword => text.includes(keyword));
            const hasSuggestion = text.includes('sugest') || text.includes('melhor') || text.includes('deveria');

            if (hasPositive) positiveFeedbacks++;
            if (hasNegative) negativeFeedbacks++;
            if (hasSuggestion) suggestions++;
        });

        document.getElementById('positiveFeedbacks').textContent = positiveFeedbacks;
        document.getElementById('negativeFeedbacks').textContent = negativeFeedbacks;
        document.getElementById('suggestions').textContent = suggestions;
    }

    updateTimeAnalysis(votes) {
        if (votes.length === 0) {
            document.getElementById('peakTime').textContent = '-';
            document.getElementById('weeklyTrend').textContent = '-';
            document.getElementById('monthlyGrowth').textContent = '0%';
            return;
        }

        // Peak time analysis
        const hourCounts = {};
        votes.forEach(vote => {
            const hour = new Date(vote.timestamp).getHours();
            hourCounts[hour] = (hourCounts[hour] || 0) + 1;
        });

        const peakHour = Object.keys(hourCounts).reduce((a, b) => 
            hourCounts[a] > hourCounts[b] ? a : b
        );
        document.getElementById('peakTime').textContent = `${peakHour}:00h`;

        // Weekly trend
        const lastWeek = votes.filter(vote => {
            const voteDate = new Date(vote.timestamp);
            const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
            return voteDate >= weekAgo;
        });

        const trend = lastWeek.length > votes.length / 2 ? 'Crescente' : 'Est√°vel';
        document.getElementById('weeklyTrend').textContent = trend;

        // Monthly growth (simulated)
        const growth = Math.floor(Math.random() * 20) + 5;
        document.getElementById('monthlyGrowth').textContent = `+${growth}%`;
    }

    updateCustomerOpinions() {
        const votes = this.getFilteredVotes();
        const opinionsWithFeedback = votes.filter(vote => vote.feedback && vote.feedback.trim().length > 0);
        
        this.renderOpinions(opinionsWithFeedback);
    }

    renderOpinions(opinions) {
        const opinionsList = document.getElementById('opinionsList');
        
        if (!opinionsList) return; // Adicionado para evitar erro se o elemento n√£o existir

        if (opinions.length === 0) {
            opinionsList.innerHTML = '<div class="no-opinions">Nenhuma opini√£o encontrada para o filtro selecionado.</div>';
            return;
        }

        let filteredOpinions = opinions;
        
        // Apply opinion filter
        if (this.currentOpinionFilter === 'positive') {
            filteredOpinions = opinions.filter(opinion => this.isPositiveOpinion(opinion.feedback));
        } else if (this.currentOpinionFilter === 'negative') {
            filteredOpinions = opinions.filter(opinion => this.isNegativeOpinion(opinion.feedback));
        } else if (this.currentOpinionFilter === 'suggestions') {
            filteredOpinions = opinions.filter(opinion => this.hasSuggestion(opinion.feedback));
        }

        if (filteredOpinions.length === 0) {
            opinionsList.innerHTML = '<div class="no-opinions">Nenhuma opini√£o encontrada para este filtro.</div>';
            return;
        }

        const opinionsHTML = filteredOpinions.map(opinion => {
            const ratingEmoji = this.getRatingEmoji(opinion.generalRating);
            const sentiment = this.getOpinionSentiment(opinion.feedback);
            
            // Format timestamp to date and time
            const dateObj = new Date(opinion.timestamp);
            const formattedDate = dateObj.toLocaleDateString('pt-BR');
            const formattedTime = dateObj.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });

            return `
                <div class="opinion-item">
                    <div class="opinion-header">
                        <div class="opinion-rating">
                            <span>${ratingEmoji}</span>
                            <span>${opinion.generalRating.toUpperCase()}</span>
                            <span class="sentiment-badge ${sentiment.class}">${sentiment.label}</span>
                        </div>
                        <div class="opinion-date">
                            ${formattedDate} √†s ${formattedTime}
                        </div>
                    </div>
                    <div class="opinion-text">
                        "${opinion.feedback}"
                    </div>
                    <div class="opinion-sectors">
                        ${opinion.sectorRatings.vendas ? `<div class="opinion-sector"><i class="fas fa-shopping-cart"></i> Vendas: ${opinion.sectorRatings.vendas}</div>` : ''}
                        ${opinion.sectorRatings.caixa ? `<div class="opinion-sector"><i class="fas fa-cash-register"></i> Caixa: ${opinion.sectorRatings.caixa}</div>` : ''}
                        ${opinion.sectorRatings.expedicao ? `<div class="opinion-sector"><i class="fas fa-truck"></i> Expedi√ß√£o: ${opinion.sectorRatings.expedicao}</div>` : ''}
                    </div>
                </div>
            `;
        }).join('');

        opinionsList.innerHTML = opinionsHTML;
    }

    getRatingEmoji(rating) {
        const emojis = {
            'ruim': 'üòû',
            'regular': 'üòê',
            'bom': 'üòä',
            'excelente': 'ü§©'
        };
        return emojis[rating] || 'üòê';
    }

    getOpinionSentiment(feedback) {
        const text = feedback.toLowerCase();
        const positiveKeywords = ['bom', '√≥timo', 'excelente', 'parab√©ns', 'satisfeito', 'recomendo', 'gostei', 'perfeito'];
        const negativeKeywords = ['ruim', 'p√©ssimo', 'demora', 'problema', 'insatisfeito', 'reclama√ß√£o', 'horr√≠vel', 'terr√≠vel'];
        
        const hasPositive = positiveKeywords.some(keyword => text.includes(keyword));
        const hasNegative = negativeKeywords.some(keyword => text.includes(keyword));
        
        if (hasPositive && !hasNegative) {
            return { label: 'Positivo', class: 'positive' };
        } else if (hasNegative && !hasPositive) {
            return { label: 'Negativo', class: 'negative' };
        } else {
            return { label: 'Neutro', class: 'neutral' };
        }
    }

    isPositiveOpinion(feedback) {
        const text = feedback.toLowerCase();
        const positiveKeywords = ['bom', '√≥timo', 'excelente', 'parab√©ns', 'satisfeito', 'recomendo', 'gostei', 'perfeito'];
        return positiveKeywords.some(keyword => text.includes(keyword));
    }

    isNegativeOpinion(feedback) {
        const text = feedback.toLowerCase();
        const negativeKeywords = ['ruim', 'p√©ssimo', 'demora', 'problema', 'insatisfeito', 'reclama√ß√£o', 'horr√≠vel', 'terr√≠vel'];
        return negativeKeywords.some(keyword => text.includes(keyword));
    }

    hasSuggestion(feedback) {
        const text = feedback.toLowerCase();
        return text.includes('sugest') || text.includes('melhor') || text.includes('deveria') || text.includes('poderia');
    }

    filterOpinions(filter) {
        this.currentOpinionFilter = filter;

        // Update opinion filter buttons
        document.querySelectorAll('.opinion-filter-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        // Find the clicked button using event.target and add 'active' class
        const clickedButton = event.target;
        if (clickedButton && clickedButton.classList.contains('opinion-filter-btn')) {
            clickedButton.classList.add('active');
        }

        // Re-render opinions with new filter
        this.updateCustomerOpinions();
    }

    renderCharts() {
        this.renderGeneralChart();
        this.renderSectorChart();
        this.renderTimeChart();
    }

    renderGeneralChart() {
        const canvas = document.getElementById('generalChartCanvas');
        if (!canvas) return;
        
        const ctx = canvas.getContext('2d');
        const votes = this.getFilteredVotes();

        // Clear canvas
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Count ratings
        const counts = {
            'ruim': 0,
            'regular': 0,
            'bom': 0,
            'excelente': 0
        };

        votes.forEach(vote => {
            if (counts.hasOwnProperty(vote.generalRating)) {
                counts[vote.generalRating]++;
            }
        });

        // Chart settings
        const colors = {
            'ruim': '#ff4444',
            'regular': '#ff9800',
            'bom': '#4CAF50',
            'excelente': '#FFD700'
        };

        const labels = {
            'ruim': 'Ruim',
            'regular': 'Regular',
            'bom': 'Bom',
            'excelente': 'Excelente'
        };

        // Draw bar chart
        const maxCount = Math.max(...Object.values(counts), 1);
        const barWidth = 150;
        const barSpacing = 50;
        const chartHeight = 200;
        const startX = 50;
        const startY = 250;

        Object.keys(counts).forEach((rating, index) => {
            const barHeight = (counts[rating] / maxCount) * chartHeight;
            const x = startX + index * (barWidth + barSpacing);
            const y = startY - barHeight;

            // Draw bar
            ctx.fillStyle = colors[rating];
            ctx.fillRect(x, y, barWidth, barHeight);

            // Draw label
            ctx.fillStyle = '#ffffff';
            ctx.font = '14px Inter';
            ctx.textAlign = 'center';
            ctx.fillText(labels[rating], x + barWidth / 2, startY + 20);

            // Draw count
            ctx.fillStyle = '#FFD700';
            ctx.font = 'bold 16px Inter';
            ctx.fillText(counts[rating], x + barWidth / 2, y - 10);
        });
    }

    renderSectorChart() {
        const canvas = document.getElementById('sectorChartCanvas');
        if (!canvas) return;
        
        const ctx = canvas.getContext('2d');
        const votes = this.getFilteredVotes();

        // Clear canvas
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Calculate sector averages
        const sectors = ['vendas', 'caixa', 'expedicao'];
        const sectorLabels = {
            'vendas': 'Vendas',
            'caixa': 'Caixa',
            'expedicao': 'Expedi√ß√£o'
        };

        const sectorAverages = this.calculateSectorAverages(votes);

        // Draw bar chart
        const maxRating = 4;
        const barWidth = 200;
        const barSpacing = 50;
        const chartHeight = 200;
        const startX = 50;
        const startY = 250;

        const colors = ['#FFD700', '#FFA500', '#FF8C00'];

        sectors.forEach((sector, index) => {
            const barHeight = (sectorAverages[sector] / maxRating) * chartHeight;
            const x = startX + index * (barWidth + barSpacing);
            const y = startY - barHeight;

            // Draw bar
            ctx.fillStyle = colors[index];
            ctx.fillRect(x, y, barWidth, barHeight);

            // Draw label
            ctx.fillStyle = '#ffffff';
            ctx.font = '14px Inter';
            ctx.textAlign = 'center';
            ctx.fillText(sectorLabels[sector], x + barWidth / 2, startY + 20);

            // Draw average
            ctx.fillStyle = '#FFD700';
            ctx.font = 'bold 16px Inter';
            ctx.fillText(sectorAverages[sector].toFixed(1), x + barWidth / 2, y - 10);
        });
    }

    renderTimeChart() {
        const canvas = document.getElementById('timeChartCanvas');
        if (!canvas) return;
        
        const ctx = canvas.getContext('2d');
        const votes = this.getFilteredVotes();

        // Clear canvas
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        if (votes.length === 0) {
            ctx.fillStyle = '#ffffff';
            ctx.font = '16px Inter';
            ctx.textAlign = 'center';
            ctx.fillText('Nenhum dado dispon√≠vel', canvas.width / 2, canvas.height / 2);
            return;
        }

        // Group votes by date
        const votesByDate = {};
        votes.forEach(vote => {
            const date = new Date(vote.timestamp).toISOString().split('T')[0]; // Use ISO string for consistent date key
            if (!votesByDate[date]) {
                votesByDate[date] = [];
            }
            votesByDate[date].push(vote);
        });

        // Get last 7 days
        const dates = Object.keys(votesByDate).sort().slice(-7);
        const counts = dates.map(date => votesByDate[date].length);

        if (dates.length === 0) {
            ctx.fillStyle = '#ffffff';
            ctx.font = '16px Inter';
            ctx.textAlign = 'center';
            ctx.fillText('Nenhum dado dispon√≠vel', canvas.width / 2, canvas.height / 2);
            return;
        }

        // Draw line chart
        const maxCount = Math.max(...counts, 1);
        const chartWidth = 600;
        const chartHeight = 200;
        const startX = 100;
        const startY = 250;
        const pointSpacing = chartWidth / (dates.length - 1 || 1);

        // Draw grid lines
        ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
        ctx.lineWidth = 1;
        for (let i = 0; i <= 5; i++) {
            const y = startY - (i / 5) * chartHeight;
            ctx.beginPath();
            ctx.moveTo(startX, y);
            ctx.lineTo(startX + chartWidth, y);
            ctx.stroke();
        }

        // Draw line
        ctx.strokeStyle = '#FFD700';
        ctx.lineWidth = 3;
        ctx.beginPath();

        counts.forEach((count, index) => {
            const x = startX + index * pointSpacing;
            const y = startY - (count / maxCount) * chartHeight;

            if (index === 0) {
                ctx.moveTo(x, y);
            } else {
                ctx.lineTo(x, y);
            }

            // Draw point
            ctx.fillStyle = '#FFD700';
            ctx.beginPath();
            ctx.arc(x, y, 5, 0, 2 * Math.PI);
            ctx.fill();

            // Draw count label
            ctx.fillStyle = '#ffffff';
            ctx.font = '12px Inter';
            ctx.textAlign = 'center';
            ctx.fillText(count, x, y - 15);

            // Draw date label
            const shortDate = dates[index].split('-').slice(1).join('/');
            ctx.fillText(shortDate, x, startY + 20);
        });

        ctx.stroke();
    }

    // Download functions
    downloadReport(format = 'csv') {
        const votes = this.getFilteredVotes();
        const timestamp = new Date().toISOString().split('T')[0];

        switch (format) {
            case 'csv':
                this.downloadCSV(votes, timestamp);
                break;
            case 'txt':
                this.downloadTXT(votes, timestamp);
                break;
            case 'json':
                this.downloadJSON(votes, timestamp);
                break;
        }
    }

    downloadCSV(votes, timestamp) {
        let csvContent = "data:text/csv;charset=utf-8,";
        csvContent += "Data,Hora,Avalia√ß√£o Geral,Vendas,Setor de Caixa,Expedi√ß√£o,Feedback,UserAgent\n";

        votes.forEach(vote => {
            const dateObj = new Date(vote.timestamp);
            const formattedDate = dateObj.toLocaleDateString('pt-BR');
            const formattedTime = dateObj.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });

            const row = [
                formattedDate,
                formattedTime,
                vote.generalRating,
                vote.sectorRatings.vendas || '',
                vote.sectorRatings.caixa || '',
                vote.sectorRatings.expedicao || '',
                `"${(vote.feedback || '').replace(/"/g, '""')}"`, // Escape double quotes
                `"${(vote.userAgent || '').replace(/"/g, '""')}"`
            ].join(',');
            csvContent += row + "\n";
        });

        this.downloadFile(csvContent, `relatorio_telecimento_${timestamp}.csv`);
    }

    downloadTXT(votes, timestamp) {
        const content = this.generateNotebookReport(votes);
        const txtContent = "data:text/plain;charset=utf-8," + encodeURIComponent(content);
        this.downloadFile(txtContent, `relatorio_telecimento_${timestamp}.txt`);
    }

    downloadJSON(votes, timestamp) {
        const jsonData = {
            company: this.companyData,
            reportDate: new Date().toISOString(),
            filter: this.currentFilter,
            totalVotes: votes.length,
            votes: votes,
            statistics: this.generateStatistics(votes)
        };

        const jsonContent = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(jsonData, null, 2));
        this.downloadFile(jsonContent, `relatorio_telecimento_${timestamp}.json`);
    }

    downloadCompleteReport() {
        const votes = this.getFilteredVotes();
        const content = this.generateCompleteNotebookReport(votes);
        const timestamp = new Date().toISOString().split('T')[0];
        const txtContent = "data:text/plain;charset=utf-8," + encodeURIComponent(content);
        this.downloadFile(txtContent, `relatorio_completo_telecimento_${timestamp}.txt`);
    }

    generateNotebookReport(votes) {
        const now = new Date();
        const stats = this.generateStatistics(votes);

        let content = `\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n                            RELAT√ìRIO DE AVALIA√á√ïES\n                                 ${this.companyData.name}\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\nDADOS DA EMPRESA:\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\nNome: ${this.companyData.fullName}\nEndere√ßo: ${this.companyData.address}\nTelefone: ${this.companyData.phone}\nInstagram: ${this.companyData.instagram}\nSetores Avaliados: ${this.companyData.sectors.join(', ')}\n\nINFORMA√á√ïES DO RELAT√ìRIO:\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\nData de Gera√ß√£o: ${now.toLocaleDateString('pt-BR')} √†s ${now.toLocaleTimeString('pt-BR')}\nPer√≠odo Analisado: ${this.getFilterDescription()}\nTotal de Avalia√ß√µes: ${votes.length}\n\nRESUMO EXECUTIVO:\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n‚Ä¢ M√©dia Geral de Avalia√ß√£o: ${stats.averageRating.toFixed(1)}/4.0\n‚Ä¢ Taxa de Satisfa√ß√£o: ${stats.satisfactionRate}%\n‚Ä¢ Avalia√ß√µes Positivas: ${stats.positivePercentage}%\n‚Ä¢ Avalia√ß√µes Negativas: ${stats.negativePercentage}%\n‚Ä¢ Feedbacks Recebidos: ${stats.feedbackCount}\n\nAN√ÅLISE POR SETOR:\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n`;

        // Sector analysis
        const sectors = ['vendas', 'caixa', 'expedicao'];
        const sectorNames = {
            'vendas': 'VENDAS',
            'caixa': 'SETOR DE CAIXA',
            'expedicao': 'EXPEDI√á√ÉO'
        };

        sectors.forEach(sector => {
            const sectorStats = this.calculateSectorStats(votes, sector);
            content += `\n${sectorNames[sector]}:\n  ‚Ä¢ M√©dia: ${sectorStats.average.toFixed(1)}/4.0\n  ‚Ä¢ Total de Avalia√ß√µes: ${sectorStats.total}\n  ‚Ä¢ Taxa de Satisfa√ß√£o: ${sectorStats.satisfaction}%\n  ‚Ä¢ Distribui√ß√£o:\n    - Ruim: ${sectorStats.distribution.ruim}\n    - Regular: ${sectorStats.distribution.regular}\n    - Bom: ${sectorStats.distribution.bom}\n    - Excelente: ${sectorStats.distribution.excelente}\n`;
        });

        content += `\nAN√ÅLISE DE FEEDBACKS:\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n‚Ä¢ Feedbacks Positivos: ${stats.positiveFeedbacks}\n‚Ä¢ Feedbacks Negativos: ${stats.negativeFeedbacks}\n‚Ä¢ Sugest√µes de Melhoria: ${stats.suggestions}\n\nDETALHAMENTO DAS AVALIA√á√ïES:\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n`;


        votes.forEach((vote, index) => {
            const dateObj = new Date(vote.timestamp);
            const formattedDate = dateObj.toLocaleDateString('pt-BR');
            const formattedTime = dateObj.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });

            content += `\n${index + 1}. Data: ${formattedDate} | Hora: ${formattedTime}\n   Avalia√ß√£o Geral: ${vote.generalRating.toUpperCase()}\n   Setores: Vendas: ${vote.sectorRatings.vendas || 'N/A'} | Caixa: ${vote.sectorRatings.caixa || 'N/A'} | Expedi√ß√£o: ${vote.sectorRatings.expedicao || 'N/A'}\n   Feedback: ${vote.feedback || 'Nenhum feedback fornecido'}\n   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n`;
        });

        content += `\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n                        Relat√≥rio gerado automaticamente pelo\n                           Sistema de Opini√¥metro ${this.companyData.name}\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n`;

        return content;
    }

    generateCompleteNotebookReport(votes) {
        return this.generateNotebookReport(votes);
    }

    generateStatistics(votes) {
        const stats = {
            averageRating: this.calculateAverageRating(votes),
            satisfactionRate: this.calculateSatisfactionRate(votes),
            feedbackCount: votes.filter(v => v.feedback && v.feedback.trim()).length,
            distribution: { ruim: 0, regular: 0, bom: 0, excelente: 0 },
            positiveFeedbacks: 0,
            negativeFeedbacks: 0,
            suggestions: 0
        };

        // Count distribution
        votes.forEach(vote => {
            if (stats.distribution.hasOwnProperty(vote.generalRating)) {
                stats.distribution[vote.generalRating]++;
            }
        });

        // Calculate percentages
        stats.positivePercentage = Math.round(((stats.distribution.bom + stats.distribution.excelente) / votes.length) * 100) || 0;
        stats.negativePercentage = Math.round(((stats.distribution.ruim + stats.distribution.regular) / votes.length) * 100) || 0;

        // Analyze feedbacks
        const feedbacks = votes.filter(v => v.feedback && v.feedback.trim());
        const positiveKeywords = ['bom', '√≥timo', 'excelente', 'parab√©ns', 'satisfeito', 'recomendo'];
        const negativeKeywords = ['ruim', 'p√©ssimo', 'demora', 'problema', 'insatisfeito', 'reclama√ß√£o'];

        feedbacks.forEach(vote => {
            const text = vote.feedback.toLowerCase();
            const hasPositive = positiveKeywords.some(keyword => text.includes(keyword));
            const hasNegative = negativeKeywords.some(keyword => text.includes(keyword));
            const hasSuggestion = text.includes('sugest') || text.includes('melhor') || text.includes('deveria');

            if (hasPositive) stats.positiveFeedbacks++;
            if (hasNegative) stats.negativeFeedbacks++;
            if (hasSuggestion) stats.suggestions++;
        });

        return stats;
    }

    calculateSectorStats(votes, sector) {
        const sectorVotes = votes.filter(vote => vote.sectorRatings && vote.sectorRatings[sector]);
        const distribution = { ruim: 0, regular: 0, bom: 0, excelente: 0 };
        
        sectorVotes.forEach(vote => {
            const rating = vote.sectorRatings[sector];
            if (distribution.hasOwnProperty(rating)) {
                distribution[rating]++;
            }
        });

        return {
            average: this.calculateSectorAverage(votes, sector),
            total: sectorVotes.length,
            satisfaction: this.calculateSectorSatisfaction(votes, sector),
            distribution: distribution
        };
    }

    getFilterDescription() {
        const descriptions = {
            'all': 'Todos os per√≠odos',
            'today': 'Apenas hoje',
            'week': '√öltimos 7 dias',
            'month': '√öltimos 30 dias'
        };
        return descriptions[this.currentFilter] || 'Per√≠odo personalizado';
    }

    downloadFile(content, filename) {
        const link = document.createElement("a");
        link.setAttribute("href", content);
        link.setAttribute("download", filename);
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        this.showMessage(`Relat√≥rio ${filename} baixado com sucesso!`, 'success');
    }

    showMessage(text, type = 'info') {
        const container = document.getElementById('messageContainer');
        if (!container) return; // Adicionado para evitar erro se o elemento n√£o existir

        const message = document.createElement('div');
        message.className = `message ${type}`;
        message.textContent = text;

        container.appendChild(message);

        // Show message
        setTimeout(() => {
            message.classList.add('show');
        }, 100);

        // Hide message after 5 seconds
        setTimeout(() => {
            message.classList.remove('show');
            setTimeout(() => {
                if (container.contains(message)) {
                    container.removeChild(message);
                }
            }, 300);
        }, 5000);
    }
}

// Global functions for HTML onclick events
function clearAllData() {
    window.opiniometroAdmin.clearAllData();
}

function resetVotingTime() {
    window.opiniometroAdmin.resetVotingTime();
}

function filterData(filter) {
    window.opiniometroAdmin.filterData(filter);
}

function downloadReport(format) {
    window.opiniometroAdmin.downloadReport(format);
}

function downloadCompleteReport() {
    window.opiniometroAdmin.downloadCompleteReport();
}

function filterOpinions(filter) {
    window.opiniometroAdmin.filterOpinions(filter);
}

// Initialize admin system when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    window.opiniometroAdmin = new OpiniometroAdmin();
});

    </script>
</body>
</html>


